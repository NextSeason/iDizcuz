<!DOCTYPE html>
<html>
    <head>
        <?php 
            $title = $topic[ 'title' ] . ' - 每日论点 • iDizcuz';
        ?>
        <?php include TPL_PATH . '/common/head.inc.html'; ?>
        <link rel="stylesheet" href="/static/common/css/umeditor/default/css/umeditor.css?_t=1444380571667" />
        <link rel="stylesheet" href="/static/common/css/post.css?_t=1444380571667" />
        <link rel="stylesheet" href="/static/topic/css/topic.css?_t=1444380571667" />
    </head>
    <body>
        <div id="idizcuz" 
            data-account-id="<?php echo isset( $account['id'] ) ? $account['id'] : 0; ?>" 
            data-account-uname="<?php echo isset( $account['uname'] ) ? htmlspecialchars( $account['uname'] ) : ''; ?>"
        >
            <?php include TPL_PATH . '/common/top.inc.html'; ?>
            <div class="boxes body">
                <div class="inner">
                    <div class="sidebar aside">
                        <?php if( $account ) { ?>
                            <?php if( isset( $topic ) ) { ?>
                                <a href="###" class="btns large fullsize show-editor need-fixed">发布我的论述</a>
                            <?php } ?>
                            <?php include TPL_PATH . '/common/userpages.inc.html'; ?>
                        <?php } else { ?>
                            <?php include TPL_PATH . '/common/signin.inc.html'; ?>
                        <?php } ?>
                    </div>
                    <div class="topic-area main" data-topic-id="<?php echo $topic[ 'id' ]; ?>">
                        <?php if( !empty( $post ) ) { ?>
                            <div class="target-post">
                                <?php if( $post['data']['status'] > 0 ) { ?>
                                    <div class="removed">
                                        此论述以被删除，您可以
                                        [<a href="/user/activities/<?php echo $post['account_id']; ?>">访问该用户主页</a>]
                                        或
                                        [<a href="/topic/<?php echo $topic['id']; ?>">查看论述所在话题</a>]
                                    </div>
                                <?php } else { ?>
                                    <div class="posts" id="post-<?php echo $post['id']; ?>" data-post-id="<?php echo $post['id']; ?>">
                                        <div class="data-line clearfix">
                                            <div class="operates r">
                                                <?php if( !$post['own'] ) { ?>
                                                    <?php if( $post['mark'] ) { ?>
                                                        <a href="###" class="op-btn op-unmark" data-action="mark" data-marked="1">
                                                            <i class="fa fa-star"></i> 取消收藏
                                                        </a>
                                                    <?php } else { ?>
                                                        <a href="###" class="op-btn op-mark" data-action="mark" data-marked="0">
                                                            <i class="fa fa-star-o"></i> 收藏
                                                        </a>
                                                    <?php } ?>
                                                <?php } ?>
                                                <a href="###" class="op-btn op-share" data-action="share">分享</a>
                                                <?php if( !$post['own'] ) { ?>
                                                    <a href="###" class="op-btn" data-action="report">举报</a>
                                                <?php } ?>
                                            </div>
                                            <div class="vote l">
                                                <a href="###" class="op-btn btns small agree" data-action="agree" data-intent="1">支持(<b><?php echo $post['data']['agree']; ?></b>)</a>
                                                <a href="###" class="op-btn btns small disagree" data-action="agree" data-intent="0">反对(<b><?php echo $post['data']['disagree']; ?></b>)</a>
                                            </div>
                                            <div class="title l">
                                                <h2><a href="/post/<?php echo $post['id']; ?>"><?php echo htmlspecialchars( $post['title'] ); ?></a></h2>
                                                <a href="/user/activities/<?php echo $post['account_id']; ?>" class="uname" target="_blank">
                                                    作者： <?php echo htmlspecialchars( $post['account']['uname'] ); ?>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="bubbles op-bubbles">
                                            <a href="###" class="close"><i class="fa fa-times"></i></a>
                                            <div class="triangle"><div class="triangle"></div></div>
                                            <div class="inner">
                                                <div class="mark box clearfix">
                                                    <p class="l">收藏成功！您可以在<a href="/user/mark/<?php echo $account['id']; ?>">我的主页</a>中查看。您也可以分享这条论述，让更多人参与讨论</p>
                                                    <div class="share-box l">
                                                        <a class="share-btns" data-dest="qzone"><i class="fa fa-qq"></i></a>
                                                        <a class="share-btns" data-dest="weibo"><i class="fa fa-weibo"></i></a>
                                                        <a class="share-btns" data-dest="renren"><i class="fa fa-renren"></i></a>
                                                        <a class="share-btns" data-dest="tx_weibo"><i class="fa fa-tencent-weibo"></i></a>
                                                        <a class="share-btns" data-dest="facebook"><i class="fa fa-facebook-official"></i></a>
                                                        <a class="share-btns" data-dest="twitter"><i class="fa fa-twitter"></i></a>
                                                    </div>
                                                </div>
                                                <div class="share box clearfix">
                                                    <div class="qrcode l"></div>
                                                    <div class="share-part l">
                                                        <div class="bdsharebuttonbox share-btn-boxes share-box" data-tag="share_1">
                                                            <a class="share-btns" data-dest="qzone"><i class="fa fa-qq"></i></a>
                                                            <a class="share-btns" data-dest="weibo"><i class="fa fa-weibo"></i></a>
                                                            <a class="share-btns" data-dest="renren"><i class="fa fa-renren"></i></a>
                                                            <a class="share-btns" data-dest="tx_weibo"><i class="fa fa-tencent-weibo"></i></a>
                                                            <a class="share-btns" data-dest="facebook"><i class="fa fa-facebook-official"></i></a>
                                                            <a class="share-btns" data-dest="twitter"><i class="fa fa-twitter"></i></a>
                                                        </div> 
                                                        <div class="share-link">
                                                            <div class="line clearfix">
                                                                <span class="l">分享此条论述：</span>
                                                                <a href="http://www.idizcuz.com/post/<?php echo $post['id']; ?>?fr=share" data-title="<?php echo htmlspecialchars( $post['title'] ); ?>" target="_blank" class="share-post-link link l">
                                                                    http://www.idizcuz.com/post/<?php echo $post['id']; ?>?fr=share
                                                                </a>
                                                                <a href="###" class="btns l copy-link">复制链接</a>
                                                            </div>
                                                            <div class="line clearfix">
                                                                <span class="l">分享当前话题：</span>
                                                                <a href="http://www.idizcuz.com/topic/<?php echo $topic['id']; ?>?fr=share" data-title="<?php echo $topic['title']; ?>>" target="_blank" class="share-topic-link link l">
                                                                    http://www.idizcuz.com/topic/<?php echo $topic['id']; ?>?fr=share
                                                                </a>
                                                                <a href="###" class="btns l copy-link">复制链接</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="report box clearfix">
                                                    <div class="reasons l">
                                                        <?php foreach( $reportReasons as $key => $value ) { ?>
                                                            <label>
                                                                <input type="radio" name="reasons-<%=data[i].id %>" value="<?php echo $key; ?>" />
                                                                <span class="msg"><?php echo $value; ?></span>
                                                            </label>
                                                        <?php } ?>
                                                    </div>
                                                    <div class="l desc-area">
                                                        <textarea class="desc" placeholder="请对您举报的内容做简单描述，长度不可超过250字"></textarea>
                                                        <p class="brand alert">*  核实举报后此论述会被删除，作者将受到相关惩罚。恶意举报也将面对相关策略惩罚</p>
                                                        <div class="btn-line">
                                                            <span class="tip"></span>
                                                            <a href="###" class="btns report-submit">提交举报</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="contents rich-text">
                                            <p><?php echo $post['content']; ?></p>
                                        </div>
                                        <?php if( $post['to'] != 0 ) { ?>
                                            <div class="to-area">
                                                <span><i class="fa fa-hand-o-right"></i> 所针对论述：</span>
                                                <a href="/post/<?php echo $post['to']['id']; ?>" target="_blank"><?php echo $post['to']['title']; ?></a>
                                            </div>
                                        <?php } ?>
                                        <div class="bottom-line">
                                            <a href="#editor" class="reply-to r">针对本条论述发布观点</a>
                                            <span class="ctime">发布于：<?php echo substr( $post['ctime'], 0, -9 ); ?></span>
                                            <?php if( $post['ctime'] != $post['mtime'] ) { ?>
                                                <span class="mtime">最后修改于：<?php echo substr( $post['mtime'], 0, -9 ); ?></span>
                                            <?php } ?>
                                            <a href="###" class="comments" data-cursor="0">
                                                <?php echo $post['data']['comments_cnt']; ?> 条短评
                                            </a>
                                            <?php if( $post['own'] ) { ?>
                                                <a href="###" class="remove-post" title="删除后论述可以在个人中心找到，可在个人中心恢复发布或彻底删除"><i class="fa fa-trash"></i> 删除</a>
                                            <?php } ?>
                                        </div>
                                        <div class="comment-box">
                                            <div class="loading"></div>
                                            <ul class="comment-list"></ul>
                                            <div class="load-more">加载更多短评</div>
                                            <ul class="new-comment-list"></ul>
                                            <form class="comment-form clearfix">
                                                <input type="submit" class="btns submit aside" value="发布" />
                                                <div class="main">
                                                    <div contentEditable="true" class="comment" placeholder="输入短评内容"></div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                <?php } ?>
                                <div class="bridge">
                                    以下为此论述所在的『话题』内容
                                    <a href="/topic/<?php echo $topic['id']; ?>" target="_blank">[ 单独打开话题 ]</a>
                                </div>
                            </div>
                        <?php } ?>
                        <div class="title-line">
                            <h1>
                                <span class="seal seal-<?php echo $topic['data']['type']; ?>"></span>
                                <?php echo htmlspecialchars( $topic['title'] ); ?>
                            </h1>
                            <p class="info">
                                <a href="/list" target="_blank" class="btns dark r">更多话题</a>
                                <span>话题日期：<?php echo substr( $topic['ctime'], 0, -9 ); ?></span>
                                <span>分类：<a href="/list/<?php echo $topic['data']['cid']; ?>"><?php echo $topic['data']['cate']; ?></a></span>
                            </p>
                        </div>
                        <div class="desc">
                            <?php echo $topic[ 'desc' ]; ?>
                            <div class="bottom-line">
                                <a href="/articles/<?php echo $topic['id']; ?>" target="_blank">[更多相关资料和信息]</a>
                            </div>
                        </div>
                        <?php if( $topic['data']['type'] == 1 ) { ?>
                            <style>
                                <?php 
                                    $colors = ['#E9733C', '#3BA1E0', '#b13011'];
                                    $i = 0;
                                    foreach( $points as $point ) { 
                                ?>
                                .point-flag-<?php echo $point['id']; ?> { color : <?php echo $colors[$i]; ?>; }
                                <?php $i++; } ?>
                            </style>
                            <div class="point-area">
                                <?php $arr = ['一','二','三','四','五']; ?>
                                <ul class="clearfix">
                                    <?php $i = 0; foreach( $points as $point ) { ?>
                                        <li>
                                            <div class="points">
                                                <div class="point-data r">
                                                    <div class="base-data">
                                                        <b class="triangle"><b class="triangle"></b></b>
                                                        <span>论述 <b class="brand"><?php echo $point['data']['post_cnt']; ?></b></span>
                                                        <span>支持 <b class="brand"><?php echo $point['data']['agree']; ?></b></span>
                                                        <span>反对 <b class="brand"><?php echo $point['data']['disagree']; ?></b></span>
                                                    </div>
                                                    <span href="###" class="index">指数 <b class="brand"><?php echo $point['data']['index']; ?></b></span>
                                                </div>
                                                <div class="title">
                                                    <i class="fa fa-flag point-flag-<?php echo $point['id']; ?>"></i>
                                                    <span>观点<?php echo $arr[$i]; ?>：<?php echo $point['title']; ?></span>
                                                </div>
                                            </div>
                                        </li>
                                    <?php $i++; } ?>
                                </ul>
                                <ul class="clearfix split-point-list">
                                    <?php $i = 0; foreach( $points as $point ) { ?>
                                        <li>
                                            <div class="points ">
                                                <div class="title">
                                                    <i class="fa fa-flag point-flag-<?php echo $point['id']; ?>"></i>
                                                    <span>观点<?php echo $arr[$i]; ?>：<?php echo $point['title']; ?></span>
                                                </div>
                                                <div class="point-data">
                                                    <span>论述 <b class="brand"><?php echo $point['data']['post_cnt']; ?></b></span>
                                                    <span>支持 <b class="brand"><?php echo $point['data']['agree']; ?></b></span>
                                                    <span>反对 <b class="brand"><?php echo $point['data']['disagree']; ?></b></span>
                                                    <span href="###" class="index">指数 <b class="brand"><?php echo $point['data']['index']; ?></b></span>
                                                </div>
                                            </div>
                                        </li>
                                    <?php $i++; } ?>
                                </ul>
                            </div>
                        <?php } ?>
                        <div class="list-area">
                            <div class="operate-line clearfix">
                                <span class="count">本话题共 <i class="brand"><?php echo $topic['data']['post_cnt']; ?></i> 条讨论</span>
                                <ul class="sort-list r clearfix">
                                    <li><a href="###" class="focus sort" data-order-type="0">最新讨论</a></li>
                                    <li><a href="###" class="sort" data-order="1">最多支持</a></li>
                                    <li><a href="###" class="sort" data-order="2" >最多反对</a></li>
                                </ul>  
                                <?php if( $topic['data']['type'] == 1 ) { ?>
                                    <div class="filter-box">
                                        <a href="javascript:void(0)" class="current"><i class="fa fa-flag-o"></i></a>
                                        <div class="filter-list">
                                            <a href="###"><i class="fa fa-flag-o"></i></a>
                                            <?php foreach( $points as $point ) { ?>
                                                <a href="###" data-point-id="<?php echo $point['id']; ?>">
                                                    <i class="fa fa-flag point-flag-<?php echo $point['id']; ?>"></i>
                                                </a>
                                            <?php } ?>
                                        </div>
                                    </div>
                                <?php } ?>
                            </div>
                            <ul class="post-list"></ul>
                            <div class="loading list-bottom"></div>
                        </div>
                        <div id="post-pagination" class="pagination clearfix"></div>
                        <div id="editor-inflow-box">
                            <div id="editor-area" class="editor-area">
                                <?php if( $account ) { ?>
                                    <div class="line clearfix">
                                        <span class="s-post-title">论述标题：</span>
                                        <input type="text" class="long title" placeholder="如果标题为空，系统则自动获取部分论述内容作为标题" />
                                        <?php if( $topic['data']['type'] == 1 ) { ?>
                                            <input type="hidden" class="point_id" value="0" />
                                            <div class="select-point r">
                                                <span class="s-agree-title">选择支持的观点：</span>
                                                <a href="###" class="i-agree">
                                                    <i class="fa fa-flag-o"></i>
                                                    <div class="point-area point-selector">
                                                        <ul class="clearfix">
                                                            <?php $arr = ['一','二','三','四','五']; $i = 0; ?>
                                                            <?php foreach( $points as $point ) { ?>
                                                                <li>
                                                                    <div class="points" data-point-id="<?php echo $point['id']; ?>">
                                                                        <i class="fa fa-flag point-flag-<?php echo $point['id']; ?>"></i>
                                                                        <span>观点<?php echo $arr[$i]; ?>：<?php echo $point['title']; ?></span>
                                                                    </div>
                                                                </li>
                                                            <?php $i++; } ?>
                                                        </ul>
                                                    </div>
                                                </a>
                                            </div>
                                        <?php } ?>
                                    </div>
                                    <div id="textbox" class="textbox">
                                        <script type="text/plain" id="editor" class="editor">
                                            <p>在此输入您想发布的内容</p>
                                        </script>
                                    </div>
                                    <div class="line tip-line clearfix">
                                        <div class="to-line l">
                                            <span>针对论述：</span>
                                            <a href="###" class="to-title" target="_blank"></a>
                                            <input type="hidden" class="to" />
                                            <a href="###" class="remove-to"><i class="fa fa-times-circle"></i></a>
                                        </div>
                                        <div class="vcode-area r">
                                            <input type="text" class="imagecode short" placeholder="验证码" />
                                            <img src="/common/interface/imagecode" class="refresh-imagecode l" />
                                            <a href="###" class="refresh-imagecode">
                                                <i class="fa fa-refresh"></i> 
                                                看不清，换一张
                                            </a>
                                        </div>
                                    </div>
                                    <div class="submit-line clearfix">
                                        <a href="###" class="r btns large public">发布观点</a>
                                        <p class="post-warn r"></p>
                                    </div>
                                <?php } else { ?>
                                    <div id="textbox" class="textbox">
                                        <div class="not-login-editor">
                                            <p>请登录并发布您的观点
                                                <a href="/signin">登录</a>
                                                /
                                                <a href="/signup">注册</a>
                                            </p>
                                        </div>
                                    </div>
                                <?php } ?>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <?php include TPL_PATH . '/common/foot.inc.html'; ?>
            <div id="complain-box" data-target-id="0">
                <form>
                    <input type="hidden" class="comment_id" />
                    <?php foreach( $reportReasons as $key => $value ) { ?>
                        <label>
                            <input type="radio" name="reasons-<%=data[i].id %>" value="<?php echo $key; ?>" />
                            <span class="msg"><?php echo $value; ?></span>
                        </label>
                    <?php } ?>
                    <textarea placeholder="简述您的举报理由"></textarea>
                    <div class="op-line">
                        <a href="###" class="cancel">取消</a>
                        <a href="###" class="btns">提交</a>
                    </div>
                </form>
            </div>
            <div id="editor-dialog" class="dialogs">
                <div class="inner">
                    <a href="###" class="minus"><i class="fa fa-times"></i></a>
                    <div id="editor-float-box"></div>
                </div>
            </div>
            <div class="side-nav-bar">
                <div class="write-post item">
                    <a href="###" class="btns"><i class="fa fa-pencil-square-o"></i></a>
                    <div class="bubbles left small">
                        <div class="triangle"><div class="triangle"></div></div>
                        <div class="inner">
                            <p>发布论述</p>
                        </div>
                    </div>
                </div>
                <div class="scroll-top item">
                    <a href="###" class="btns"><i class="fa fa-angle-up"></i></a>
                    <div class="bubbles left small">
                        <div class="triangle"><div class="triangle"></div></div>
                        <div class="inner">
                            <p>回到顶部</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- templates area start -->
        <?php include TPL_PATH . '/common/pagination.inc.html'; ?>
        <textarea class="templates" id="post-list-tpl">
            <% if( !data.length ) { %>
                <li class="empty">此话题目前还没有论述，快发布您的论述，并分享给您的好友吧</li>
            <% } else { %>
                <% for( var i = 0, l = data.length; i < l; i += 1 ) { var post = data[i]; %>
                    <% if( post.hide ) { continue } %>
                    <li>
                        <?php include TPL_PATH . '/common/post.tpl.html'; ?>
                    </li>
                <% } %>
            <% } %>
        </textarea>
        <textarea class="templates" id="comment-list-tpl">
            <% for( var i = 0, l = data.length; i < l; i += 1 ) { %>
                <li>
                    <?php include TPL_PATH . '/common/comment.tpl.html'; ?>
                </li>
            <% } %>
        </textarea>
        <script src="/static/common/js/umeditor.config.js?_t=1444380571667"></script>
        <script src="/static/common/js/umeditor.js?_t=1444380571667"></script>
        <script src="/static/common/js/qrcode.js?_t=1444380571667"></script>
        <script src="/static/common/js/ZeroClipboard.js?_t=1444380571667"></script>
        <script>
            var idizcuz = new J();

            var showEditorDialog = function() {
                $( '#editor-float-box' ).append( $( '#editor-area' ) );
                $( '#editor-dialog' ).show();
            };

            var hideEditorDialog = function() {
                $( '#editor-inflow-box' ).append( $( '#editor-area' ) );
                $( '#editor-dialog' ).hide();
            };

            idizcuz.mount( 'topnavfixed', '/static/common/packages/Fixed/bootstrap.js?_t=1444380571633', {
                el : $( '.boxes.top-nav' ),
                onfixed : function() {
                    this.el.css( 'width', '100%' );
                    this.el.find( '.logo' ).show();
                },
                onunfixed : function() {
                    this.el.find( '.logo' ).hide();
                }
            } );

            $( '.show-editor.need-fixed' ).length && idizcuz.mount( 'showeditbtnfixed', '/static/common/packages/Fixed/bootstrap.js?_t=1444380571633', {
                el : $( '.show-editor.need-fixed' ),
                dis : 5,
                onfixed : function() {
                    this.el.addClass( 'fixed' );
                },
                onunfixed : function() {
                    this.el.removeClass( 'fixed' );
                }
            } );

            idizcuz.mount( 'editor', '/static/topic/packages/Editor/bootstrap.js?_t=1444380571633', { 
                'topic' : {
                    id : "<?php echo $topic['id']; ?>",
                    type : "<?php echo $topic['data']['type']; ?>",
                    title : '<?php echo $topic['title']; ?>'
                },
                account : {
                    id : '<?php echo $account ? $account['id'] : 0; ?>',
                    uname : '<?php echo $account ? $account['uname'] : 0; ?>'
                }
            } );
            idizcuz.mount( 'posts', '/static/topic/packages/Posts/bootstrap.js?_t=1444380571633', {
                topic : {
                    id : "<?php echo $topic['id']; ?>",
                    title : "<?php echo $topic['title']; ?>"
                }
            } );
            idizcuz.mount( 'operate', '/static/common/packages/PostOperate/bootstrap.js?_t=1444380571633', {
                signin : +'<?php echo $account ? 1 : 0; ?>',
                fullFunction : true
            } );
            idizcuz.mount( 'comments', '/static/common/packages/Comments/bootstrap.js?_t=1444380571633', {
                signin : +'<?php echo $account ? 1 : 0; ?>'
            } );
            idizcuz.mount( 'share', '/static/common/packages/Share/bootstrap.js?_t=1444380571633', {} );
            idizcuz.mount( 'copy', '/static/common/packages/Copy/bootstrap.js?_t=1444380571633', {} );
            idizcuz.mount( 'sidebar', '/static/topic/packages/Sidebar/bootstrap.js?_t=1444380571633', {} );
            idizcuz.mount( 'sidenavbar', '/static/topic/packages/Sidenavbar/bootstrap.js?_t=1444380571633', {} );
        </script>
        <?php include TPL_PATH . '/common/end.inc.html'; ?>
    </body>
</html>
